!function(){"use strict";angular.module("complaints.controllers",[]),angular.module("complaints.services",[]),angular.module("complaints.directives",[]),angular.module("complaints.filters",[]);var a=angular.module("complaints",["ngCordova","complaints.controllers","complaints.services","complaints.directives","complaints.filters","ionic"]).value("version","0.1");a.config(["$urlRouterProvider","$httpProvider","$stateProvider",function(a,b,c){b.interceptors.push("authInterceptor"),c.state("login",{url:"/login",templateUrl:"complaints/login/login.html",controller:"LoginController"}).state("register",{url:"/register",templateUrl:"complaints/register/register.html",controller:"RegisterController"}).state("reset",{url:"/reset",templateUrl:"complaints/reset/reset.html",controller:"ResetController"}).state("home",{url:"/home",templateUrl:"complaints/home/home.html",controller:"HomeController"}).state("create",{url:"/create",templateUrl:"complaints/create/create.html",controller:"CreateController"}).state("changePassword",{url:"/changePassword",templateUrl:"complaints/changePassword/changePassword.html",controller:"ChangePasswordController"}).state("complaint",{url:"/complaint/:complaintId",templateUrl:"complaints/complaint/complaint.html",controller:"ComplaintController"}),a.otherwise("/login")}])}(),angular.module("complaints.services").factory("authInterceptor",["$rootScope","$q","$window","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.localStorage.token&&(a.headers["X-Auth-Token"]=c.localStorage.token),a},response:function(a){return 401===a.status&&(delete c.localStorage.token,d.path("login")),a||b.when(a)}}}]),angular.module("complaints.controllers").controller("ChangePasswordController",["ChangePasswordService","$scope","$ionicLoading","$location","$ionicPopup","$window",function(a,b,c,d,e,f){b.password={},b.comparePassword=function(a){return a?a.first==a.second:void 0},b.changePassword=function(g,h){b.comparePassword(h)&&(g.newPassword=h.first,c.show({templateUrl:"loader.html",duration:8e3}),a.changePassword(g).then(function(a){c.hide(),f.localStorage.token=a.token,d.path("home")},function(a){c.hide(),a.status?(b.error=a.data.message,e.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">{{error}}</p>',scope:b})):e.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">Check your connection and try again.</p>'})}))}}]),angular.module("complaints.services").factory("ChangePasswordService",["$http",function(a){return{changePassword:function(b){return a.post("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/user/changePassword",b).then(function(a){return a.data})}}}]),angular.module("complaints.controllers").controller("ComplaintController",["ComplaintService","$scope","$stateParams","$location","$ionicLoading",function(a,b,c,d,e){var f=c.complaintId;b.laoded=!1,e.show({templateUrl:"loader.html"}),a.getComplaint(f).then(function(a){b.complaint=a.dbResp.complaint,b.complaint.imageData&&(b.cameraImage="data:image/jpeg;base64,"+b.complaint.imageData),b.loaded=!0,e.hide()},function(){e.hide(),d.path("home")}),b.submitComment=function(c){c.complaintId=f,a.submitComment(c).then(function(){var a=c;b.complaint.commentEntities.push(a)},function(){alert("Fail")})},b.toggleGroup=function(a){b.shownGroup=b.isGroupShown(a)?null:a},b.isGroupShown=function(a){return b.shownGroup===a}}]),angular.module("complaints.services").factory("ComplaintService",["$http",function(a){return{getComplaint:function(b){return a.get("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/complaint/getComplaint/"+b).then(function(a){return a.data})},submitComment:function(b){return a.post("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/complaint/createComment",b).then(function(a){return a.data})}}}]),angular.module("complaints.controllers").controller("CreateController",["CreateService","$scope","$ionicSlideBoxDelegate","$cordovaCamera","$ionicPopup","$ionicLoading","$location",function(a,b,c,d,e,f,g){b.complaint={},b.submitComplaint=function(c){f.show({templateUrl:"loader.html"}),a.createComplaint(c).then(function(){f.hide(),g.path("home")},function(a){f.hide(),a.status?(b.error=a.data.message,e.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">{{error}}</p>',scope:b})):e.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">Check your connection and try again.</p>'})})},b.takePicture=function(){var a={quality:75,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};d.getPicture(a).then(function(a){b.cameraImage="data:image/jpeg;base64,"+a,b.complaint.imageData=a},function(){})},b.getImage=function(){var a={destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800};d.getPicture(a).then(function(a){b.cameraImage="data:image/jpeg;base64,"+a,b.complaint.imageData=a},function(){})},b.loadImagePopup=function(){e.alert({title:"Image Taken",template:'<img class="popupPic" src="{{cameraImage}}">',scope:b,buttons:[{text:"OK",type:"button-positive"}]})},b.nextPage=function(){c.next()},b.previousPage=function(){c.previous()},b.disableSwipe=function(){c.enableSlide(!1)}}]),angular.module("complaints.services").service("CreateService",["$http",function(a){this.createComplaint=function(b){return a.post("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/complaint/createComplaint",b).then(function(a){return a.data})}}]),angular.module("complaints.controllers").controller("HomeController",["$scope","$window","$location","HomeService","$ionicPlatform","$state","$ionicSideMenuDelegate","$ionicPopup",function(a,b,c,d,e,f,g,h){a.groups=[{status:"New Grumbls",color:"tealAcc",complaints:[],statusCode:"N"},{status:"Pending Grumbl Response",color:"blueAcc",complaints:[],statusCode:"P"},{status:"Additional Details Required",color:"orangeAcc",complaints:[],statusCode:"A"},{status:"Grumbl Resolved",color:"greenAcc",complaints:[],statusCode:"R"}],a.shownGroup=a.groups[0],e.onHardwareBackButton(function(){g.isOpen()?g.toggleRight():"home"===f.current.name&&navigator.app.exitApp()}),d.getDetails().then(function(b){b.complaintEntities.forEach(function(b){a.groups.forEach(function(a){a.statusCode===b.status&&a.complaints.push(b)})}),a.userDetails=b},function(a){h.alert(a.status?{title:"<strong>An error has occured!</strong>",template:'<p class="errorText">Session has expired.</p>'}:{title:"<strong>An error has occured!</strong>",template:'<p class="errorText">Check your connection and try again.</p>'}),delete b.localStorage.token,c.path("login")}),a.logout=function(){delete b.localStorage.token,c.path("login")},a.createGrumbl=function(){c.path("create")},a.toggleRight=function(){g.toggleRight()},a.toggleGroup=function(b){a.shownGroup=a.isGroupShown(b)?null:b},a.changePass=function(){c.path("changePassword")},a.isGroupShown=function(b){return a.shownGroup===b}}]),angular.module("complaints.services").factory("HomeService",["$http",function(a){return{getDetails:function(){return a.get("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/user/getUser").then(function(a){return a.data})}}}]),angular.module("complaints.controllers").controller("LoginController",["$scope","LoginService","$window","$location","$ionicLoading",function(a,b,c,d,e){c.localStorage.token&&d.path("home"),a.authenticate=function(f){e.show({templateUrl:"loader.html"}),b.login(f).then(function(a){c.localStorage.token=a.token,e.hide(),d.path("home")},function(b){a.errorText=b.data?b.data.message:0===b.status?"There is a problem with the internet connection.":"Please enter user details",delete c.localStorage.token,e.hide()})}}]),angular.module("complaints.services").service("LoginService",["$http",function(a){this.login=function(b){return a.post("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/user/authenticate",b).then(function(a){return a.data})}}]),angular.module("complaints.controllers").controller("RegisterController",["RegisterService","$scope","$location","$window","LoginService","$ionicLoading","$ionicPopup",function(a,b,c,d,e,f,g){b.checkUsername=function(c){a.checkUsername(c).then(function(a){b.doesUserExist=a})},b.comparePassword=function(a){b.passwordsMatch=a.first==a.second?!0:!1},b.createUser=function(d,e,h){d.$valid?b.passwordsMatch&&(f.show({templateUrl:"loader.html"}),e.password=h.first,a.createUser(e).then(function(){f.hide(),c.path("login")},function(a){f.hide(),a.status?(b.error=a.data.message,g.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">{{error}}</p>',scope:b})):g.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">Check your connection and try again.</p>'})})):g.alert({title:"An error has occured!",template:"The form is invalid."})},b.returnToLogin=function(){c.path("login")}}]),angular.module("complaints.services").factory("RegisterService",["$http",function(a){return{checkUsername:function(b){return a.post("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/user/checkUsername",{username:b}).then(function(a){return a.data})},createUser:function(b){return a.post("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/user/createUser",b).then(function(a){return a.data})}}}]),angular.module("complaints.controllers").controller("ResetController",["ResetService","$ionicSlideBoxDelegate","$scope","$location","$ionicLoading","$ionicPopup",function(a,b,c,d,e,f){c.forgottenRadio="Username",c.resetPassword=function(b){e.show({templateUrl:"loader.html"}),a.resetPassword(b).then(function(){e.hide(),d.path("login")},function(a){e.hide(),a.status?(c.error=a.data.message,f.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">{{error}}</p>',scope:c})):f.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">Check your connection and try again.</p>'})})},c.usernameReminder=function(b){e.show({templateUrl:"loader.html"}),a.usernameReminder(b).then(function(){e.hide(),d.path("login")},function(a){e.hide(),a.status?(c.error=a.data.message,f.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">{{error}}</p>',scope:c})):f.alert({title:"<strong>An error has occured!</strong>",template:'<p class="errorText">Check your connection and try again.</p>'})})},c.selected="username",c.returnToLogin=function(){d.path("login")},c.nextPage=function(){b.next(),c.selected="password"},c.previousPage=function(){b.previous(),c.selected="username"},c.disableSwipe=function(){b.enableSlide(!1)}}]),angular.module("complaints.services").factory("ResetService",["$http",function(a){return{resetPassword:function(b){return a.get("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/user/resetPassword/"+b).then(function(a){return a.data})},usernameReminder:function(b){return a.get("http://default-environment-4y3vry6tx2.elasticbeanstalk.com/service/user/forgottenUsername/"+b).then(function(a){return a.data})}}}]),angular.module("complaints.directives").directive("heightTarget",["$window",function(a){return{restrict:"A",link:function(b,c){var d=a.outerHeight;d+=2,c.css("height",d+"px")}}}]);